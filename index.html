<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For You üíó</title>
  <style>
    :root{
      --bg:#fbfaf7;
      --ink:#111;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 50% 30%, #ffffff 0%, var(--bg) 60%, #f5f1ea 100%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", Arial;
      color:#222;
      overflow:hidden;
    }

    .wrap{
      width:min(960px, 92vw);
      height:min(560px, 70vh);
      position:relative;
      border-radius:28px;
      background: rgba(255,255,255,.6);
      box-shadow: 0 18px 60px rgba(0,0,0,.08);
      backdrop-filter: blur(6px);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
    }

    .hint{
      position:absolute;
      left:18px; top:14px;
      display:flex;
      gap:10px;
      align-items:center;
      z-index:7;
      font-weight:700;
      letter-spacing:.2px;
      opacity:.95;
      user-select:none;
    }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(0,0,0,.06);
      font-weight:700;
      font-size:14px;
    }

    .btn{
      cursor:pointer;
      border:0;
      font-weight:800;
      border-radius:999px;
      padding:10px 14px;
      background:#111;
      color:#fff;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
      transition:.15s transform;
    }
    .btn:active{ transform: scale(.98); }

    /* SVG drawing */
    svg{ width:100%; height:100%; display:block; }
    .stroke{
      fill:none;
      stroke: var(--ink);
      stroke-width:6;
      stroke-linecap:round;
      stroke-linejoin:round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: draw 2.2s ease forwards;
    }
    .stroke.thin{ stroke-width:5; }
    .stroke.soft{ stroke: rgba(17,17,17,.92); }
    .d1{ animation-delay: .15s; }
    .d2{ animation-delay: .35s; }
    .d3{ animation-delay: .55s; }
    .d4{ animation-delay: .8s;  }
    .d5{ animation-delay: 1.05s; }
    .d6{ animation-delay: 1.35s; }
    @keyframes draw{ to{ stroke-dashoffset: 0; } }

    /* üî´ Gun (SVG text) */
    .gun{
      font-size:34px;
      opacity:0;
      transform-box: fill-box;
      transform-origin:center;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.18));

      /* ‚úÖ ‡∏´‡∏±‡∏ô‡∏õ‡∏∑‡∏ô‡∏ñ‡∏π‡∏Å‡∏ó‡∏≤‡∏á + ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô */
      transform: scaleX(-1) rotate(-12deg) scale(.92);

      animation: gunPop .35s ease forwards, gunKick .22s ease-out forwards;
      animation-delay: 1.55s, 2.05s;
    }
    @keyframes gunPop{
      from{ opacity:0; transform: scaleX(-1) rotate(-20deg) scale(.6); }
      to  { opacity:1; transform: scaleX(-1) rotate(-12deg) scale(.92); }
    }
    @keyframes gunKick{
      0%  { transform: scaleX(-1) rotate(-12deg) scale(.92) translate(0,0); }
      45% { transform: scaleX(-1) rotate(-18deg) scale(.92) translate(-2px, 1px); } /* recoil */
      100%{ transform: scaleX(-1) rotate(-12deg) scale(.92) translate(0,0); }
    }

    /* ‚ù§Ô∏è Hearts layer */
    .hearts{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:4;
    }
    .heart{
      position:absolute;
      left:0; top:0;
      font-size:26px;
      opacity:0;
      will-change: transform, opacity;
      filter:
        drop-shadow(0 10px 14px rgba(0,0,0,.12))
        drop-shadow(0 0 10px rgba(255, 105, 180, .35)); /* glow ‡∏´‡∏ß‡∏≤‡∏ô */
    }

    /* ‚ú® Sparks layer */
    .sparks{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:6;
    }
    .spark{
      position:absolute;
      left:0; top:0;
      opacity:0;
      will-change: transform, opacity;
      filter:
        drop-shadow(0 10px 10px rgba(0,0,0,.12))
        drop-shadow(0 0 10px rgba(255, 196, 0, .45));
      animation: sparkOut var(--dur, 520ms) cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes sparkOut{
      0%{
        opacity:0;
        transform: translate(-50%, -50%) translate(var(--x), var(--y)) scale(.6) rotate(var(--rot, 0deg));
      }
      15%{ opacity:1; }
      100%{
        opacity:0;
        transform: translate(-50%, -50%)
          translate(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy)))
          scale(.2)
          rotate(calc(var(--rot, 0deg) + 80deg));
      }
    }

    /* Subtitle */
    .subtitle{
      position:absolute;
      left:22px;
      bottom:18px;
      z-index:7;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(0,0,0,.06);
      border-radius:18px;
      padding:10px 14px;
      max-width:min(520px, 86%);
      line-height:1.25;
      font-weight:800;
    }

    @media (max-width:520px){
      .subtitle{ font-size:14px; }
      .heart{ font-size:22px; }
      .gun{ font-size:30px; }
    }
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <div class="hint">
      <div class="pill" id="toLabel">To: You üíó</div>
      <button class="btn" id="replayBtn">Replay</button>
    </div>

    <div class="sparks" id="sparks"></div>
    <div class="hearts" id="hearts"></div>

    <svg viewBox="0 0 960 560" aria-label="romantic doodle">
      <!-- head -->
      <path class="stroke soft d1" d="M165 320
        C120 320, 92 288, 92 246
        C92 190, 130 150, 185 150
        C242 150, 280 190, 280 246
        C280 290, 248 320, 210 320
        Z" />
      <!-- body -->
      <path class="stroke soft d2" d="M120 315
        C112 362, 120 450, 185 450
        C250 450, 260 366, 250 315" />
      <!-- legs -->
      <path class="stroke d3" d="M150 450 C150 495, 120 505, 118 530" />
      <path class="stroke d3" d="M220 450 C220 495, 250 505, 252 530" />
      <!-- face -->
      <path class="stroke thin d4" d="M150 245 C152 245, 154 247, 154 249 C154 251, 152 253, 150 253 C148 253, 146 251, 146 249 C146 247, 148 245, 150 245 Z" />
      <path class="stroke thin d4" d="M220 245 C222 245, 224 247, 224 249 C224 251, 222 253, 220 253 C218 253, 216 251, 216 249 C216 247, 218 245, 220 245 Z" />
      <path class="stroke thin d5" d="M165 270 C178 283, 195 283, 206 270" />
      <!-- arm -->
      <path class="stroke d6" d="M250 340 C300 320, 330 300, 360 290" />

      <!-- üî´ gun at hand -->
      <text class="gun" x="368" y="292">üî´</text>
    </svg>

    <div class="subtitle">
      ‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏ò‡∏≠‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏à‡∏±‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á ‡πÄ‡∏•‡∏¢‡πÄ‡∏≠‡∏≤‡πÉ‡∏à‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏≤‡∏ö‡∏ö
    </div>
  </div>

  <script>
    const wrapEl   = document.getElementById("wrap");
    const heartsEl = document.getElementById("hearts");
    const sparksEl = document.getElementById("sparks");
    const replayBtn = document.getElementById("replayBtn");
    const toLabel = document.getElementById("toLabel");

    // --- set name from querystring (?to=Jenny) ---
    const params = new URLSearchParams(location.search);
    const to = params.get("to");
    if (to) toLabel.textContent = `To: ${to} üíó`;

    function restartSVG(){
      const oldSvg = wrapEl.querySelector("svg");
      const clone = oldSvg.cloneNode(true);
      oldSvg.replaceWith(clone);
    }

    // --- heart targets (same as canvas sample) ---
  function buildHeartTargets(count, W, H){
  // safe padding ‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡∏Ç‡∏≠‡∏ö (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏¢‡∏≠‡∏∞‡∏´‡∏ô‡πà‡∏≠‡∏¢)
  const padX = Math.max(24, W * 0.06);
  const padTop = Math.max(20, H * 0.06);
  const padBottom = Math.max(90, H * 0.18); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ subtitle ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á

  // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ô‡∏¥‡∏î)
  const isMobile = W < 520;
  const scale = Math.min(W, H) * (isMobile ? 0.0165 : 0.018);

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∏‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à (parametric) ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Å‡∏£‡∏≠‡∏ö min/max
  const base = [];
  let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;

  for(let i=0;i<count;i++){
    const t = (i / count) * Math.PI * 2;
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);

    const px = x * scale;
    const py = -y * scale; // invert y (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)

    base.push({ px, py });

    if (px < minX) minX = px;
    if (px > maxX) maxX = px;
    if (py < minY) minY = py;
    if (py > maxY) maxY = py;
  }

  // ‡∏ï‡∏±‡πâ‡∏á cx/cy ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô
  let cx = W * (isMobile ? 0.68 : 0.72);
  let cy = H * (isMobile ? 0.44 : 0.44);

  // ‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏ö‡∏µ‡∏ö/‡∏î‡∏±‡∏ô‚Äù ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Ç‡∏≠‡∏ö (clamp)
  const left   = cx + minX;
  const right  = cx + maxX;
  const top    = cy + minY;
  const bottom = cy + maxY;

  if (left < padX) cx += (padX - left);
  if (right > W - padX) cx -= (right - (W - padX));
  if (top < padTop) cy += (padTop - top);
  if (bottom > H - padBottom) cy -= (bottom - (H - padBottom));

  // ‡∏Ñ‡∏∑‡∏ô targets
  return base.map(p => ({ x: cx + p.px, y: cy + p.py }));
}

    // ‚úÖ compute muzzle point from actual gun element on screen
    function getMuzzlePos(){
      const svg = wrapEl.querySelector("svg");
      const gun = svg.querySelector(".gun");
      const rWrap = heartsEl.getBoundingClientRect();
      const rGun  = gun.getBoundingClientRect();

      // muzzle is "front" of gun (after flip). ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ 0.78 / 0.55 ‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
      const x = (rGun.left + rGun.width * 0.78) - rWrap.left;
      const y = (rGun.top  + rGun.height * 0.55) - rWrap.top;
      return { x, y };
    }

    function clearAll(){
      heartsEl.innerHTML = "";
      sparksEl.innerHTML = "";
    }

    // ‚ú® spark burst at muzzle
    function sparkBurst(x, y){
      const count = 10;
      const glyphs = ["‚ú®","‚ú¶","‚úß","üí•","‚≠ê"];
      for(let i=0;i<count;i++){
        const sp = document.createElement("span");
        sp.className = "spark";
        sp.textContent = glyphs[Math.floor(Math.random() * glyphs.length)];

        const ang = (-20 + Math.random() * 40) * Math.PI / 180; // mostly forward
        const speed = 26 + Math.random() * 46;
        const dx = Math.cos(ang) * speed;
        const dy = Math.sin(ang) * speed - (10 + Math.random() * 18);

        sp.style.setProperty("--x", x + "px");
        sp.style.setProperty("--y", y + "px");
        sp.style.setProperty("--dx", dx.toFixed(1) + "px");
        sp.style.setProperty("--dy", dy.toFixed(1) + "px");
        sp.style.setProperty("--rot", (Math.random() * 120 - 60).toFixed(0) + "deg");
        sp.style.setProperty("--dur", (420 + Math.random() * 240).toFixed(0) + "ms");

        // ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å/‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡πà‡∏°‡∏ô‡∏¥‡∏î‡πÜ
        sp.style.fontSize = (14 + Math.random() * 10).toFixed(0) + "px";
        sp.style.opacity = "0";

        sparksEl.appendChild(sp);

        // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ DOM ‡∏ö‡∏ß‡∏°
        setTimeout(() => sp.remove(), 900);
      }
    }

    // main: shoot hearts
    function spawnHearts(){
      heartsEl.innerHTML = "";
      sparksEl.innerHTML = "";

      const W = heartsEl.clientWidth;
      const H = heartsEl.clientHeight;

      const TOTAL = 230;
      const targets = buildHeartTargets(TOTAL, W, H);

      // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π "‡∏£‡∏±‡∏ß‡πÜ" ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏´‡∏±‡∏ß‡πÉ‡∏à
      const order = targets
        .map(t => ({...t, r: Math.random()}))
        .sort((a,b) => a.r - b.r);

      // ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏õ‡∏∑‡∏ô‡∏à‡∏£‡∏¥‡∏á
      const muzzle = getMuzzlePos();
      const originX = muzzle.x;
      const originY = muzzle.y;

      const bullets = [];
      const emoji = "üíñ"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ‚ù§Ô∏è üíó üß° ‡πÑ‡∏î‡πâ

      order.forEach((t, idx) => {
        const el = document.createElement("span");
        el.className = "heart";
        el.textContent = emoji;
        heartsEl.appendChild(el);

        const dx = t.x - originX;
        const dy = t.y - originY;
        const dist = Math.hypot(dx, dy);

        bullets.push({
          el,
          sx: originX, sy: originY,
          tx: t.x, ty: t.y,
          delay: idx * 34, // ‡∏¢‡∏¥‡∏á‡∏£‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î
          dur: 720 + Math.random() * 260,
          arc: Math.min(95, Math.max(38, dist * 0.12)),
          start: null,
          sparked: false,
          done: false
        });
      });

      const t0 = performance.now();

      function easeOutCubic(p){ return 1 - Math.pow(1 - p, 3); }

      function raf(now){
        let allDone = true;

        for(const b of bullets){
          if (b.done) continue;

          const elapsed = now - t0;
          if (elapsed < b.delay){
            allDone = false;
            continue;
          }

          if (b.start === null) b.start = now;

          const p0 = Math.min(1, (now - b.start) / b.dur);
          const p = easeOutCubic(p0);

          // ‚ú® spark ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏¥‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞‡πÄ‡∏•‡πá‡∏Å ‡πÜ)
          if (!b.sparked && p0 > 0.02){
            b.sparked = true;
            // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡πá‡∏î‡∏à‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞‡πÑ‡∏õ: ‡∏¢‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡πÄ‡∏°‡πá‡∏î‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏ó‡πà
            if (Math.random() < 0.55) sparkBurst(originX + 2, originY - 2);
          }

          // ‡πÇ‡∏Ñ‡πâ‡∏á sin ‡πÅ‡∏ö‡∏ö canvas
          const x = b.sx + (b.tx - b.sx) * p;
          const y = b.sy + (b.ty - b.sy) * p - Math.sin(p * Math.PI) * b.arc;

          // ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÇ‡∏ú‡∏•‡πà + ‡∏Ç‡∏¢‡∏≤‡∏¢
          const opacity = Math.min(1, p0 * 3);
          const sc = 0.35 + (1 - 0.35) * Math.min(1, p0 * 1.25);

          b.el.style.opacity = String(opacity);
          b.el.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) scale(${sc})`;

          if (p0 >= 1){
            b.el.style.opacity = "1";
            b.el.style.transform = `translate(-50%, -50%) translate(${b.tx}px, ${b.ty}px) scale(1)`;
            b.done = true;
          } else {
            allDone = false;
          }
        }

        if (!allDone) requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    }

    function playAll(){
      clearAll();
      restartSVG();
      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ SVG clone ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á
      requestAnimationFrame(() => spawnHearts());
    }

    replayBtn.addEventListener("click", playAll);
    playAll();
  </script>
</body>
</html>
