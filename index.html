<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For You üíó</title>
  <style>
    :root{
      --bg:#fbfaf7;
      --ink:#111;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 50% 30%, #ffffff 0%, var(--bg) 60%, #f5f1ea 100%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", Arial;
      color:#222;
      overflow:hidden;
    }

    .wrap{
      width:min(960px, 92vw);
      height:min(560px, 70vh);
      position:relative;
      border-radius:28px;
      background: rgba(255,255,255,.6);
      box-shadow: 0 18px 60px rgba(0,0,0,.08);
      backdrop-filter: blur(6px);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
    }

    .hint{
      position:absolute;
      left:18px; top:14px;
      display:flex;
      gap:10px;
      align-items:center;
      z-index:5;
      font-weight:700;
      letter-spacing:.2px;
      opacity:.9;
      user-select:none;
    }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(0,0,0,.06);
      font-weight:700;
      font-size:14px;
    }

    .btn{
      cursor:pointer;
      border:0;
      font-weight:800;
      border-radius:999px;
      padding:10px 14px;
      background:#111;
      color:#fff;
      box-shadow:0 10px 24px rgba(0,0,0,.15);
      transition:.15s transform;
    }
    .btn:active{ transform: scale(.98); }

    svg{
      width:100%;
      height:100%;
      display:block;
    }
    .stroke{
      fill:none;
      stroke: var(--ink);
      stroke-width:6;
      stroke-linecap:round;
      stroke-linejoin:round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: draw 2.2s ease forwards;
    }
    .stroke.thin{ stroke-width:5; }
    .stroke.soft{ stroke: rgba(17,17,17,.92); }

    .d1{ animation-delay: .15s; }
    .d2{ animation-delay: .35s; }
    .d3{ animation-delay: .55s; }
    .d4{ animation-delay: .8s;  }
    .d5{ animation-delay: 1.05s; }
    .d6{ animation-delay: 1.35s; }

    @keyframes draw{
      to{ stroke-dashoffset: 0; }
    }

    /* ‚ù§Ô∏è ‡∏¢‡∏¥‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à */
    .hearts{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:3;
    }
    .heart{
      position:absolute;
      left:0; top:0;           /* ‡∏à‡∏∞‡∏Ç‡∏¢‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ transform */
      opacity:0;
      font-size:26px;
      transform: translate(-50%, -50%) translate(var(--x), var(--y)) scale(.35);
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.10));
      user-select:none;
      will-change: transform, opacity;
    }

    .subtitle{
      position:absolute;
      left:22px;
      bottom:18px;
      z-index:5;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(0,0,0,.06);
      border-radius:18px;
      padding:10px 14px;
      max-width:min(520px, 86%);
      line-height:1.25;
      font-weight:800;
    }

    @media (max-width:520px){
      .subtitle{ font-size:14px; }
      .heart{ font-size:22px; }
    }
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <div class="hint">
      <div class="pill" id="toLabel">To: You üíó</div>
      <button class="btn" id="replayBtn">Replay</button>
    </div>

    <div class="hearts" id="hearts"></div>

    <svg viewBox="0 0 960 560">
      <path class="stroke soft d1" d="M165 320
        C120 320, 92 288, 92 246
        C92 190, 130 150, 185 150
        C242 150, 280 190, 280 246
        C280 290, 248 320, 210 320 Z" />
      <path class="stroke soft d2" d="M120 315
        C112 362, 120 450, 185 450
        C250 450, 260 366, 250 315" />
      <path class="stroke d3" d="M150 450 C150 495, 120 505, 118 530" />
      <path class="stroke d3" d="M220 450 C220 495, 250 505, 252 530" />
      <path class="stroke thin d4" d="M150 245 C152 245,154 247,154 249 C154 251,152 253,150 253 C148 253,146 251,146 249 C146 247,148 245,150 245 Z" />
      <path class="stroke thin d4" d="M220 245 C222 245,224 247,224 249 C224 251,222 253,220 253 C218 253,216 251,216 249 C216 247,218 245,220 245 Z" />
      <path class="stroke thin d5" d="M165 270 C178 283,195 283,206 270" />
      <path class="stroke d6" d="M250 340 C300 320,330 300,360 290" />
    </svg>

    <div class="subtitle">
    ‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏ò‡∏≠‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏à‡∏±‡∏á‡∏á‡∏á‡∏á‡∏á‡∏á
    </div>
  </div>

  <script>
    const heartsEl  = document.getElementById("hearts");
    const replayBtn = document.getElementById("replayBtn");
    const toLabel   = document.getElementById("toLabel");

    // --- set name from querystring (?to=Jenny) ---
    const params = new URLSearchParams(location.search);
    const to = params.get("to");
    if (to) toLabel.textContent = `To: ${to} üíó`;

    // ‚úÖ ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á canvas
    function buildHeartTargets(count, W, H){
      const targets = [];
      const scale = Math.min(W,H)*0.018; // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à
      const cx = W*0.72;
      const cy = H*0.44;

      for(let i=0;i<count;i++){
        const t = (i/count)*Math.PI*2;
        const x = 16*Math.pow(Math.sin(t),3);
        const y = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        targets.push({ x: cx + x*scale, y: cy - y*scale });
      }
      return targets;
    }

    function clearHearts(){
      heartsEl.innerHTML = "";
    }

    // ‚úÖ ‡∏¢‡∏¥‡∏á‡πÅ‡∏ö‡∏ö ‚Äú‡πÇ‡∏Ñ‡πâ‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á‚Äù (sin arc) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô canvas
    function spawnHearts(){
      clearHearts();

      const W = heartsEl.clientWidth;
      const H = heartsEl.clientHeight;

      // ‡∏à‡∏∏‡∏î‡∏¢‡∏¥‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡πÑ‡∏î‡πâ)
      const originX = W * 0.43;
      const originY = H * 0.52;

      const TOTAL = 220;
      const targets = buildHeartTargets(TOTAL, W, H);

      // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏¢‡∏¥‡∏á‡∏£‡∏±‡∏ß‡πÜ‚Äù ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÜ
      const order = targets
        .map((t) => ({...t, r: Math.random()}))
        .sort((a,b) => a.r - b.r);

      const emoji = "‚ù§Ô∏è"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ: üíñ üíó üß°

      // ‡πÄ‡∏Å‡πá‡∏ö state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö animation
      const bullets = [];

      order.forEach((t, idx) => {
        const el = document.createElement("span");
        el.className = "heart";
        el.textContent = emoji;

        // ‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà origin ‡∏Å‡πà‡∏≠‡∏ô (‡∏î‡πâ‡∏ß‡∏¢ CSS vars x/y)
        el.style.setProperty("--x", originX + "px");
        el.style.setProperty("--y", originY + "px");
        el.style.opacity = "0";

        heartsEl.appendChild(el);

        const dx = t.x - originX;
        const dy = t.y - originY;
        const dist = Math.hypot(dx, dy);

        bullets.push({
          el,
          sx: originX,
          sy: originY,
          tx: t.x,
          ty: t.y,
          // ‡∏¢‡∏¥‡∏á‡∏£‡∏±‡∏ß
          delay: idx * 40,     // ms
          dur: 760 + Math.random()*260, // ms
          // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á: ‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏Å‡∏•‡∏¢‡∏¥‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
          arc: Math.min(90, Math.max(35, dist * 0.12)),
          start: null,
          done: false
        });
      });

      // RAF loop
      const t0 = performance.now();

      function easeOutCubic(p){ return 1 - Math.pow(1 - p, 3); }

      function raf(now){
        let allDone = true;

        for (const b of bullets){
          if (b.done) continue;

          const elapsed = now - t0;
          if (elapsed < b.delay){
            allDone = false;
            continue;
          }

          if (b.start === null) b.start = now;

          const p0 = Math.min(1, (now - b.start) / b.dur);
          const p = easeOutCubic(p0);

          // ‚úÖ ‡πÇ‡∏Ñ‡πâ‡∏á‡πÅ‡∏ö‡∏ö sin ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô canvas)
          const x = b.sx + (b.tx - b.sx) * p;
          const y = b.sy + (b.ty - b.sy) * p - Math.sin(p * Math.PI) * b.arc;

          b.el.style.setProperty("--x", x + "px");
          b.el.style.setProperty("--y", y + "px");

          // fade in ‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
          b.el.style.opacity = String(Math.min(1, p0 * 3));

          // pop scale ‡πÄ‡∏•‡πá‡∏Å‡πÜ
          const sc = 0.35 + (1 - 0.35) * Math.min(1, p0 * 1.2);
          b.el.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) scale(${sc})`;

          if (p0 >= 1){
            // ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏ï‡∏¥‡∏î‚Äù ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á‡πÜ
            b.el.style.opacity = "1";
            b.el.style.transform = `translate(-50%, -50%) translate(${b.tx}px, ${b.ty}px) scale(1)`;
            b.done = true;
          } else {
            allDone = false;
          }
        }

        if (!allDone) requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    }

    // --- restart SVG stroke animations by cloning SVG ---
    function restartSVG(){
      const wrap = document.getElementById("wrap");
      const oldSvg = wrap.querySelector("svg");
      const clone = oldSvg.cloneNode(true);
      oldSvg.replaceWith(clone);
    }

    function playAll(){
      restartSVG();
      spawnHearts();
    }

    replayBtn.addEventListener("click", playAll);
    playAll();
  </script>
</body>
</html>
